<!DOCTYPE html>
{% load static %}
<html>

<head>
    <meta charset="UTF-8">
    <title>Doctor Availability</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'css/dashboard.css' %}">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'css/bootstrap.min.css'%}">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'css/sb-admin.css'%}">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'css/ehr.css'%}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'css/bootstrap-multiselect.css'%}">

    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.js"></script>

    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.min.js"></script>

    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.min.js.map"></script>
    <script type="text/javascript" src="bootstrap-multiselect.js"></script>
    <style>
        .multiselect-clear-filter {
            display: none;
        }

        .multiselect-search {
            margin-right: 8px;
            display: none;
        }

        .btn {
            white-space: initial !important;
            background-color: white !important;
            border-color: #cccccc;
            color: black;
            overflow: hidden;
            height: 35px !important;
            width: 193px !important;
            font-size: 14px;

        }

        .dropdown-menu {
            transform: translate3d(0px, 40px, 0px) !important;
            max-height: 200px;
            overflow: scroll;
        }

        .required label:after {
            color: #e32;
            content: '*';
            display: inline;
        }

        .ui-helper-hidden-accessible {
            display: none;
        }

        body {
            overflow: scroll;
        }

        ::-webkit-scrollbar {
            width: 0.4em !important;
            height: 0 !important;
        }

        .watermark {
            position: fixed;
            bottom: 5px;
            right: 5px;
            opacity: 0.5;
            z-index: 99;
        }

        /* btn toggle starts */
        /* .dropbtn:hover, .dropbtn:focus {
  background-color: #2980B9;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  overflow: auto;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown a:hover {background-color: #ddd;}

.show {display: block;} */
        /* btn toggle ends */

        /* Popup box BEGIN */
        /* .hover_bkgr_fricc{
    background:rgba(0,0,0,.4);
    cursor:pointer;
    display:none;
    height:100%;
    position:fixed;
    text-align:center;
    top:0;
    width:100%;
    z-index:10000;
}
.hover_bkgr_fricc .helper{
    display:inline-block;
    height:100%;
    vertical-align:middle;
}
.hover_bkgr_fricc > div {
    background-color: #fff;
    box-shadow: 10px 10px 60px #555;
    display: inline-block;
    height: auto;
    max-width: 551px;
    min-height: 100px;
    vertical-align: middle;
    width: 60%;
    position: relative;
    border-radius: 8px;
    padding: 15px 5%;
}
.popupCloseButton {
    background-color: #fff;
    border: 3px solid #999;
    border-radius: 50px;
    cursor: pointer;
    display: inline-block;
    font-family: arial;
    font-weight: bold;
    position: absolute;
    top: -20px;
    right: -20px;
    font-size: 25px;
    line-height: 30px;
    width: 30px;
    height: 30px;
    text-align: center;
}
.popupCloseButton:hover {
    background-color: #ccc;
}
.trigger_popup_fricc {
    cursor: pointer;
    font-size: 20px;
    margin: 20px;
    display: inline-block;
    font-weight: bold;
} */
        /* Popup box BEGIN */
    </style>
    <!-- <script>
    $(window).load(function () {
    $("#totalSlots").click(function(){
       $('.hover_bkgr_fricc').show();
    });
    $('.hover_bkgr_fricc').click(function(){
        $('.hover_bkgr_fricc').hide();
    });
    $('.popupCloseButton').click(function(){
        $('.hover_bkgr_fricc').hide();
    });
});
    </script> -->
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
        <a class="navbar-brand" href='/patient_list/'>HMS LAMJINGBA</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
            data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse">

            <ul class="navbar-nav navbar-sidenav" id="exampleAccordion">
                <li class="nav-item admin-name" data-toggle="tooltip" data-placement="right">

                    <img src="" alt="" class="img-ic">
                    <span class="nav-link-text"><b style="font-size:16px">Receptionist</b></span>
                </li>
                <li class="nav-item" data-toggle="tooltip" data-placement="right">
                    <a style="background-color:#64c1b1;" class="nav-link" href='/receptionistdashboard/'>
                        <i class="fa fa-tachometer" aria-hidden="true"></i>
                        <span class="nav-link-text">Dashboard</span></a>
                </li>
                <li class="nav-item" data-toggle="tooltip" data-placement="right">
                    <a class="nav-link" href='/physician_list_view/'>
                        <i class="fa fa-user-md" aria-hidden="true"></i>
                        <span class="nav-link-text">Doctor</span></a>
                </li>
            </ul>

            <ul class="navbar-nav sidenav-toggler">
                <li class="nav-item">
                    <a class="nav-link text-center" id="sidenavToggler">
                        <i class="fa fa-arrow-left" aria-hidden="true"></i>
                    </a>
                </li>
            </ul>

            <ul class="navbar-nav ml-auto">

                <li><a onclick="window.location.pathname='/logout/'" data-toggle="modal" data-target="#exampleModal"
                        style="color:white;">
                        Logout</a>

                </li>
            </ul>
        </div>
    </nav>
    <!-- <div class="hover_bkgr_fricc">
            <span class="helper"></span>
            <div>
                <div class="popupCloseButton">X</div>
                <p>Are you sure want to block <br />this slot?</p>
                <div class="row" style="margin-left: 100px;">
                    <button id="submitblockSlot" style="width:100px">Yes</button>
                    <button style="width:100px">No</button>
                </div>
            </div>
        </div> -->
    <div class="content-wrapper">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-lg">Large modal</button> -->

                <div id="myModal" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
                    aria-labelledby="myLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog  modal-dialog-centered">
                        <div class="modal-content">
                            <!-- <div class="modal-header" style="border-bottom:none"> -->
                            <!-- <h5 class="modal-title">Modal title</h5> -->
                            <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                          </button> -->
                            <!-- </div> -->
                            <div class="modal-body">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <br>
                                <p>Are you sure want to block this slot?</p>
                                <button type="button" id="confirmblock" style="background: red;width:65px">Yes</button>
                                <button type="button" id="cancelblock" data-dismiss="modal"
                                    style="width:65px">No</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% if available %}
                <div id="datedisplay">
                    <div class="col-md-4">
                        <p style="color:black">Select date to check doctor shedule </p>
                        <input type="date" class="form-control" id="inputdate">
                    </div>
                </div><br>
                <div id="totalSlots"></div>
                <div id="bookedSlots"></div>
                {% else %}
                <div id="doctoravailability-form" style="display:block">
                    <form autocomplete="off">
                        <div style="font-size:20px">Availability Timings</div>

                        <fieldset>
                            <div class="fields">
                                <div class="user-info">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <label for="stime">Start Time</label></div>
                                        <div class="col-md-4">
                                            <input type="time" name="stime" id="stime" value="" class="form-control" />
                                        </div>
                                        <div class="col-md-2">
                                            <label for="etime">End Time</label></div>
                                        <div class="col-md-4">
                                            <input type="time" name="etime" id="etime" value="" class="form-control" />
                                        </div>
                                    </div>
                                </div>
                                <div class="user-info">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <label for="duration">Appointment Duration(Min)</label></div>
                                        <div class="col-md-4">
                                            <input type="number" name="duration" id="duration" value=""
                                                placeholder="Minutes" class="form-control" onchange="slotsdisb()" />

                                        </div>
                                        <div class="col-md-2">
                                            <label for="cfee">Consultation Fee(INR)</label></div>
                                        <div class="col-md-4">
                                            <input type="number" name="fee" id="cfee" value="" placeholder="INR"
                                                class="form-control" />
                                        </div>
                                        <div class="col-md-2">
                                            <label for="multislots">Break Times</label>
                                        </div>
                                        <div class="col-md-4">
                                            <select class="mdb-select" style="width:100%!important" multiple
                                                id="multislots"></select>
                                        </div>
                                    </div>
                                </div>

                        </fieldset>
                    </form>
                    <button id="availabletimings">Save</button>
                    <div id="slots" style="width: 981px;"></div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    <span id="watermark" style="font-size:1.64rem;" unselectable="on">Powered by <span
            style="font-size:1.64rem; color: #64c1b1">CYGEN GROUP</span></span>

    <script>
        window.drf = {
            csrfHeaderName: "X-CSRFTOKEN",
            csrfCookieName: "csrftoken"
        };
    </script>
    <script>
        var doctor_id = Number({{ doc_id }});
    </script>
    <script>
        var inputDate = ''

        function slotsdisb() {
            var start = $("#stime").val();
            var endtime = $("#etime").val();
            var du = $("#duration").val();
            var d = {
                "starttime": start,
                "endtime": endtime,
                "duration": du
            }
            $.ajax({
                type: "GET",
                url: "/multibreak/",
                contentType: "application/json",
                dataType: "json",
                data: d,
                success: function (data, status) {
                    var time = '';
                    for (var i in data) {
                        console.log(data[i])
                        time += "<option value='" + data[i] + "'>" + data[i] + "</option>";
                    }
                    $("#multislots").append(time);
                    $("#multislots").multiselect('rebuild');
                    $("#multislots").html(time);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest.responseText);
                    console.log(XMLHttpRequest.status + ' ' +
                        XMLHttpRequest.statusText);
                    return false;
                }
            });
        }
    </script>
    <script>

        $(function () {
            $('#multislots').multiselect({
                includeSelectAllOption: false,
                enableFiltering: false,
                numberDisplayed: 2,
                enableCaseInsensitiveFiltering: true,
            });
        });
    </script>

    <script>
        
        
        $(function () {
            $('input[type="date"]').change(function () {
                var inputDate2 = new Date(this.value);
                var inputDate = this.value
                var load_slots = function () {
                    getAppointmentDetails(inputDate, function (data, status) {
                        if (data.slots.length > 0 || data.bookedslots.length>0 || data.blockSlot.length>0) {
                            var totalSlots = ""
                            var bookedSlots = ""
                            var breakline = 7
                            var date = ""
                            totalSlots += '<div style="font-size:26px;color:black">Slots <br> <span style="font-size:12px;"><button style="background:green;padding-bottom: 2px;padding-top: 9px;"></button>available slots</span>&emsp;<span style="font-size:12px;" ><button style="background:red;padding-bottom: 2px;padding-top: 9px;"></button>booked slots</span>&emsp;<span style="font-size:12px;"><button style="padding-top: 9px;background:grey;padding-bottom: 2px;"></button>blocked slots</span><br></div>'
                            totlist = []
                            a = data.slots.concat(data.bookedslots)
                            c = a.concat(data.blockedslots)
                            c = c.sort()
			    function checkTime(i) {
                                if (i < 10) {
                                    i = "0" + i;
                                }
                                return i;
                            }
                            var h = new Date().getHours();
                            var m =new Date().getMinutes();
                            var s=new Date().getSeconds();
			    currentTime=checkTime(h)+":"+checkTime(m)+":"+checkTime(s)
                            if (c != '') {
                                for (var i in c) {
				  
                                    if (i % breakline == 0 && i != 0) {
                                        totalSlots += '<br><br>'
                                    }
                                    var splitTime = c[i]
                                    splitTime = splitTime.slice(0, -3);

                                    if (data.slots.includes(c[i])) {
                                        totalSlots += '<input id="green" type="button" data-id="' + c[i] + '" data-inputDate="' + inputDate + '"  style="width:100px;border-radius: 5%;background:green;border:none;margin:10px;padding:10px;color:white" data-toggle="modal" data-target=".bd-example-modal-lg" class="dropbtn blockslot hover_bkgr_fricc" value="' + splitTime + '">';
                                    }
                                    else if (data.bookedslots.includes(c[i])) {
                                        totalSlots += '<input  id="red" type="button"  data-id="' + c[i] + '" data-inputDate="' + inputDate + '"  data-toggle="modal" data-target=".bd-example-modal-lg"   class="dropbtn blockslot " style="width:100px;border-radius: 5%;background:red;border:none;margin:10px;padding:10px;color:white" value="' + splitTime + '">';

                                    }
                                    else {
                                        totalSlots += '<input id="grey" type="button"  data-id="' + c[i] + '" data-inputDate="' + inputDate + '"   class="dropbtn " style="width:100px;border-radius: 5%;background:grey;border:none;margin:10px;padding:10px;color:white" value="' + splitTime + '">'
                                    }
				  

                                }
                                $("#totalSlots").html(totalSlots);
                            }
                            else {
                                $("#totalSlots").html('Slots not available')
                            }
                        }
                        else {
                        }
                    });
                }
                function getAppointmentDetails(inputDate, call_back) {
                    $.ajax({
                        type: "GET",
                        url: "/slots/" + doctor_id + "/?bookingdate=" + inputDate,
                        contentType: "application/json",
                        dataType: "json",
                        success: function (data, status) {
                            call_back(data, status);
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {

                            console.log(XMLHttpRequest.responseText);
                            console.log(XMLHttpRequest.status + ' ' +
                                XMLHttpRequest.statusText);
                            return false;
                        }
                    });
                }
                load_slots();

                $(document).on('click', 'input.blockslot', function () {
                    var id = $(this).data('id');
                    var prevId = $(this).data('id');
                    if (this.id != "grey") {
                        this.id = "yellow";
                    }

                    var SelectedDate = $("#inputdate").val();
                });
                $("#cancelblock").click(function(){
                    document.getElementById("yellow").id = "green";
                });
                $("#confirmblock").click(function () {
                    var SelectedDate = $("#inputdate").val();
                    var blockslotdata =
                    {
                        "blockdate": inputDate,
                        "blockslot": $("#yellow").val(),
                        "doctor": doctor_id
                    }

                    blockSlot(blockslotdata, function (data, status) {
                        if (status == "success") {
                            load_slots();
                        }
                    });
                });
            });
            $('#availabletimings').click(function save_doctor_available() {
                var stime = $("#stime").val();
                var etime = $("#etime").val();
                var slots = $("#multislots").val();
                var duration = $("#duration").val();
                var cfee = $("#cfee").val();
                console.log("ce", slots.join())

                var save_slot_time =
                {
                    "starttime": stime,
                    "endtime": etime,
                    "breakslots": slots.join(),
                    "appointmnetduration": duration,
                    "doctor": doctor_id,
                    "consultationfee": cfee
                }

                doctor_available(save_slot_time, function (data, status) {
                    if (status == "success") {
                        $("#stime").val("");
                        $("#etime").val("");
                        $("#multislots").multiselect("clearSelection");
                        $("#multislots").multiselect('refresh');
                        $("#duration").val("");
                        $("#cfee").val('');
                        $("#doctoravailability-form").hide();
                        $("#datedisplay").show();
                        window.location.pathname = '/doctoravailabilitystatus/' + doctor_id + '/'

                    }

                });
            });
        });
    //  for create doctor avilability timings
        function doctor_available(data, call_back) {
            console.log(" ### create_doctor_availablity_data ###");
            $.ajax({
                type: "POST",
                url: "/doctoravailability/",
                contentType: "application/json",
                data: JSON.stringify(data),
                dataType: "json",
                success: function (data, status) {
                    call_back(data, status);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest.responseText);
                    console.log(XMLHttpRequest.status + ' ' +
                        XMLHttpRequest.statusText);
                    return false;
                }
            });
        }
    //  To block  doctor slots

        function blockSlot(blockslotdata, call_back, ) {
            $.ajax({
                type: "POST",
                url: "/blockslot/" + blockslotdata.doctor + "/",
                contentType: "application/json",
                data: JSON.stringify(blockslotdata),
                dataType: "json",
                success: function (data, status) {
                    $('#myModal').modal('hide');
                    call_back(data, status)
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    //Process error actions
                    console.log(XMLHttpRequest.responseText);
                    console.log(XMLHttpRequest.status + ' ' +
                        XMLHttpRequest.statusText);
                    return false;
                }
            });
        } 
    </script>
    <script src="{% static 'js/sb-admin.js' %}"></script>
    <script src="{% static 'js/csrf.js' %}"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <!-- <script src="{% static 'js/adminscript.js' %}"></script> -->
    <!-- <script src="{% static 'js/adminajax.js' %}"></script> -->
</body>

</html>