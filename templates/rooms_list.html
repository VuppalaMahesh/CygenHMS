<!DOCTYPE html>
{% load static %}
<html>

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'css/dashboard.css' %}">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'css/bootstrap.min.css'%}">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'css/sb-admin.css'%}">
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'css/ehr.css'%}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <!-- <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css" /> -->

    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
    <!-- <link rel="stylesheet" href="bootstrap-multiselect.css" type="text/css"/> -->
    <link rel="stylesheet" type="text/css" media="screen" href="{% static 'css/bootstrap-multiselect.css'%}">

    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.js"></script>

    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.min.js"></script>

    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/js/bootstrap-multiselect.min.js.map"></script>
    <!-- <script   src="https://code.jquery.com/jquery-3.2.1.min.js"   integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="   crossorigin="anonymous"></script> -->
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>  -->
    <script type="text/javascript" src="bootstrap-multiselect.js"></script>
    <style>
    #room-form{
        display: none
        }
        .specialityContent {
            position: relative;
            z-index: 1000;
        }

        .ui-autocomplete {
            position: relative !important;
            height: 200px;
            width: 200px;
            font-size: 12px !important;
            /* overflow: visible; */
            overflow: auto;
            z-index: 1000 !important;
        }

        #docspeciality {
            z-index: 80;
        }

        .required label:after {
            color: #e32;
            content: '*';
            display: inline;
        }

        .btn {
            white-space: initial !important;
            background-color: white !important;
            border-color: #cccccc;
            color: black;
            overflow: hidden;
            height: 35px !important;
            width: 193px !important;
        }

        .dropdown-menu {
            transform: translate3d(0px, 40px, 0px) !important;
            max-height: 200px;
            overflow: scroll;
        }
        ::-webkit-scrollbar {
            width: 0.4em !important;
            height:  0 !important;
        }

        .multiselect-clear-filter {
            display: none;
        }
        .multiselect-search{
            margin-right: 8px;
        }

        body {
overflow : scroll;
}

  ::-webkit-scrollbar {
            width: 0.4em !important;
            height:  0 !important;
        }

.footer {
   position: fixed;
   left: 0;
   bottom: 0;
   width: 100%;
   background-color: white;
   color: black;
   text-align: center;
}
.watermark{
     position:fixed;
     bottom:5px;
     right:5px;
     opacity:0.5;
     z-index:99;

}




    </style>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
    <a class="navbar-brand" href=#>HMS LAMJINGBA</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
            data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
            aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse">

        <ul class="navbar-nav navbar-sidenav" id="exampleAccordion">
            <li class="nav-item admin-name" data-toggle="tooltip" data-placement="right">

                <span class="nav-link-text"><b style="font-size:16px">Admin</b></span>
            </li>
            <li class="nav-item" data-toggle="tooltip" data-placement="right">
                <a class="nav-link" href='/admindashboard/'>
                    <i class="fa fa-tachometer" aria-hidden="true"></i>
                    <span class="nav-link-text">Dashboard</span></a>
            </li>

            <li class="nav-item" data-toggle="tooltip" data-placement="right">
                <a class="nav-link"  href='/physician_list/'>
                    <i class="fa fa-user-md" aria-hidden="true"></i>
                    <span class="nav-link-text">Doctor</span></a>
            </li>
            <li class="nav-item" data-toggle="tooltip" data-placement="right">
                <a class="nav-link" href='/nurses_list/'>
                    <i class="fa fa-plus-square" aria-hidden="true"></i>
                    <span class="nav-link-text">Nurse</span></a>
            </li>
            <li class="nav-item" data-toggle="tooltip" data-placement="right">
                <a class="nav-link" href='/pharmacist_list/'>
                    <i class="fa fa-medkit" aria-hidden="true"></i>
                    <span class="nav-link-text">Pharmacist</span></a>
            </li>
            <li class="nav-item" data-toggle="tooltip" data-placement="right">
                <a class="nav-link" href='/laboratorist_list/'>
                    <i class="fa fa-flask" aria-hidden="true"></i>
                    <span class="nav-link-text">Lab Technician</span></a>
            </li>
            <li class="nav-item" data-toggle="tooltip" data-placement="right">
                <a class="nav-link" href='/receptionist_list/'>
                    <i class="fa fa-file" aria-hidden="true"></i>
                    <span class="nav-link-text">Receptionist</span></a>
            </li>
            <li class="nav-item" data-toggle="tooltip" data-placement="right">
                <a class="nav-link" style="background-color:#64c1b1;" href='/bms_list/'>
                    <i class="fa fa-bed" aria-hidden="true"></i>
                    <span class="nav-link-text">BMS</span></a>
            </li>
        </ul>

        <ul class="navbar-nav sidenav-toggler">
            <li class="nav-item">
                <a class="nav-link text-center" id="sidenavToggler">
                    <i class="fa fa-arrow-left" aria-hidden="true"></i>
                </a>
            </li>
        </ul>

        <ul class="navbar-nav ml-auto">

            <li><a onclick="window.location.pathname='/logout/' " data-toggle="modal" data-target="#exampleModal"
                   style="color:white; font-size: 16px;">
                Logout</a>

            </li>
        </ul>
    </div>
</nav>
<div class="content-wrapper">
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="content-details">
                <h3>Rooms</h3>
                <div class="row">
                    <div class="col-md-12 ">
                        <div style="margin-top: 10px;" class="add-btn right ">
                            <i class="fa fa-plus fa-lg adding room-adduser " aria-hidden="true"
                               title="Create New Room"></i>
                        </div>
                        <div class="Search">
                            <input id="myInput" type="search" class="rominput form-control" data-table="order-table"
                                   placeholder="Search">
                        </div>
                    </div>
                </div>

                <!--create Room-->
                {% csrf_token %}
                <div class="manage-table">
                    <div id="room-form" title="Room Creation">
                        <form autocomplete="off">
                            <fieldset>
                                <div class="user-info">
                                    <div class="row">
                                        <div class="col-md-2" id="Floors">
                                            <label for="floors" class="field">Floor:</label>
                                        </div>
                                        <div class="col-md-4" id="Floors">
                                            <select style=" height:40px !important;" id="floors"
                                                    title="Select floor" class="form-control">

                                            </select>

                                        </div>

                                        <div class="col-md-2" id="Wards">
                                            <label for="wards" class="field">Ward:</label></div>
                                        <div class="col-md-4" id="Wards">
                                            <select style=" height:40px !important;" id="ward"
                                                    title="Select ward" class="form-control">


                                            </select>

                                        </div>

                                        <div class="col-md-2 required" id="roomnumber">
                                            <label for="RoomNumber">Number of beds : </label></div>
                                        <div class="col-md-4">
                                            <input type="number" name="RoomNumber" id="roomnum" value=""
                                                   class="form-control" maxlength="10"/>
                                        </div>

                                        <div class="col-md-2" id="OccuType">
                                            <label for="occuType" class="field">Occu Type:</label></div>
                                        <div class="col-md-4" id="OccuType">
                                            <select style=" height:40px !important;" id="occuroomtype"
                                                    title="Select ward" class="form-control">
                                                <option value="" disabled selected>Select
                                                </option>
                                                <option value="1">Single
                                                </option>
                                                <option value="2">Double
                                            </select>

                                        </div>

                                        <div class="col-md-2" id="RoomACtype">
                                            <label for="AC" class="field">Room Type:</label></div>
                                        <div class="col-md-4" id="roomACtype">
                                            <input type="radio" id="roomACtype1" name="roomType" value="1"> AC<br>
                                            <input type="radio" id="roomACtype2" name="roomType" value="2"> Non-AC<br>
                                        </div>

                                        <div class="col-md-2 required" id="Roompricecost">
                                            <label for="roomprice">Room Price:</label></div>
                                        <div class="col-md-4">
                                            <input type="number" name="License" id="Roomprice" value=""
                                                   class="form-control" maxlength="25"/>
                                        </div>

                                    </div>
                                </div>


                            </fieldset>

                        </form>
                    </div>

                    <div class="manage-table">
                        <table class="table table-bordered table-striped order-table table"
                               style="    font-size: 13px;">
                            <thead>
                            <tr>
                                <th>Floor</th>
                                <th>Ward</th>
                                <th>Room Number</th>
                                <th>Occu Type</th>
                                <th>Room Type</th>
                                <th>Room Price</th>
                                <th>Beds Info</th>
                            </tr>
                            </thead>
                            <tbody id="roomTable">
                            <tr id="selectroom">
                            </tr>
                            </tbody>
                        </table>

                    </div>
                </div>
                <!--create user-->
                {% csrf_token %}

            </div>
            </fieldset>

            </form>
        </div>
    </div>
</div>
</div>
</div>
</div>


<span id="watermark" style="font-size:1.64rem;" unselectable="on">Powered by <span
        style="font-size:1.64rem; color: #64c1b1">CYGEN GROUP</span></span>
<script>
        window.drf = {
            csrfHeaderName: "X-CSRFTOKEN",
            csrfCookieName: "csrftoken"
        };




</script>
<script>
        (function (document) {
            'use strict';

            var LightTableFilter = (function (Arr) {

                var _input;

                function _onInputEvent(e) {
                    _input = e.target;
                    var tables = document.getElementsByClassName(_input.getAttribute('data-table'));
                    Arr.forEach.call(tables, function (table) {
                        Arr.forEach.call(table.tBodies, function (tbody) {
                            Arr.forEach.call(tbody.rows, _filter);
                        });
                    });
                }

                function _filter(row) {
                    var text = row.textContent.toLowerCase(), val = _input.value.toLowerCase();
                    row.style.display = text.indexOf(val) === -1 ? 'none' : 'table-row';
                }

                return {
                    init: function () {
                        var inputs = document.getElementsByClassName('docinput');
                        Arr.forEach.call(inputs, function (input) {
                            input.oninput = _onInputEvent;
                        });
                    }
                };
            })(Array.prototype);

            document.addEventListener('readystatechange', function () {
                if (document.readyState === 'complete') {
                    LightTableFilter.init();
                }
            });

        })(document);


</script>
<script>
        $('#toggleNavPosition').click(function () {
            $('body').toggleClass('fixed-nav');
            $('nav').toggleClass('fixed-top static-top');
        });




</script>


<script src="{% static 'js/sb-admin.js' %}"></script>
<script src="{% static 'js/csrf.js' %}"></script>
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/roomsajax.js' %}"></script>
<!--    <script src="{% static 'js/adminajax.js' %}"></script>-->
<script>
$(function () {
    var load_floor = function () {
        get_floor_data(function (data, status) {
         var floor=''
         floor +='<option value="" selected >Select floor</option>'
        for(var i in data){

        var alr= data[i]

        console.log("floordata",alr.id,alr.FloorNum)
        floor += '<option value="'+alr.id+'" >'+ 'Floor '+alr.FloorNum+'</option>'
        }
        $("#floors").html(floor);
        });
        }
        load_floor();
});
$(function () {
    var load_ward = function () {
        get_ward_data(function (data, status) {
         var ward=''
         ward +='<option value="" selected >Select floor</option>'
        for(var i in data){

        var alr= data[i]

        console.log("warddata",alr)
        ward += '<option value="'+alr.id+'" >'+ alr.WardType+'</option>'
        }
        $("#ward").html(ward);
        });
        }
        load_ward();
});


</script>
<script>

  $(function () {
    var load_room   = function () {
        get_room_data(function (data, status) {
            var room_view = ""
            console.log(data)
            if (data.length >= 0) {
                for (var i = 0; i < data.length; i++) {
                    var alr = data[i]

                    room_view += '<tr >';
                    room_view += '<td><span>' + alr.floorId + '</span></td>';
                    room_view += '<td><span>' + alr.wardId.WardType + '</span></td>';
                    room_view += '<td><span>' + alr.roomNo + '</span></td>';
                    if(alr.roomtypeId.occutype==2){
                    room_view += '<td><span>Double</span></td>';
                    }
                    else{
                    room_view += '<td><span>Single</span></td>';
                    }
                    if(alr.roomtypeId.roomtype==1){
                    room_view += '<td><span>AC</span></td>';
                    }
                    else{
                    room_view += '<td><span>NON-AC</span></td>';
                    }
                    room_view += '<td><span>' + alr.Price + '</span></td>';
                    var bedsdata = alr.beds
                    room_view += '<td><a style="color: #64c1b1; " href="javascript:void(0)" data-id='+alr.roomNo+' class="beds fa fa-pencil-square-o "></a> </td>';


                    room_view+= '</tr>';
                }
                $("#roomTable").html(room_view);


            }
        });
    }
    var new_dialog = function (type, row, room_id) {
        var dlg = $("#room-form");
        type = type || 'Create';
        var config = {
            autoOpen: true,
            height: 300,
            width: 350,
            modal: true,
            buttons: {
                "Create": save_room_data,
                "Cancel": function () {
                    dlg.dialog("close");
                }
            },
            close: function () {
                dlg.dialog("close");
            }
        };

        dlg.dialog(config);
        function save_room_data() {


            var floors = $("#floors").val();
            var ward = $("#ward").val();
            var roomnum = $("#roomnum").val();
            if($("#roomACtype1").val() !=''){
             var roomACtype = $("#roomACtype1").val();
            }
            if($("#roomACtype2").val() !=''){
             var roomACtype = $("#roomACtype2").val();
            }
            var occuroomtype = $("#occuroomtype").val();
            var Roomprice = $("#Roomprice").val();
            if (floors == '') {
                $("#dialogboxRoom1").show();
                $("#errorMsgFloor").html('Floor is mandatory');
                $("#dialogboxRoom1").delay(4000).fadeOut();
            }
            else {
            var room_data =
                {
                    "roomtypeId": {
                        "roomtype": roomACtype,
                        "occutype": occuroomtype
                         },
                    "Price": Roomprice,
                    "wardId": ward,
                    "floorId": floors,
                    "bedNum":roomnum


                }
                console.log("room_data",room_data)
                save_room(room_data,function(data,status){
                if(status=="success"){
                    dlg.dialog("close");
                }

                });


                }
            }
        }
<!--        function displayBeds(bedsData){-->
<!--        console.log(bedsData)-->
<!--        }-->
  $(document).on('click', 'a.beds', function () {
        dataroom = $(this).data('id');
        get_roomno_data(dataroom,function(data,status){
        t=''
        console.log(data.beds,"dsdsdsdsdsdsdsdss")
        var bedsfe =data.beds
        for(var i = 0; i < bedsfe.length; i++){

            var alr =bedsfe[i]
            t += '<li><span>'+'<span style="color:#64c1b1">'+'Alloted Time : '+'</span>'+alr.bedNum+'</span></li>'

            }
            t+='</table>'
            $("#bedsdialog").html(t)

            });
    });

    $(".room-adduser").button().click(new_dialog);

    load_room();

});


</script>
<script>
    function save_room(data, call_back){
    $.ajax({
 type: "POST",
 url: "/rooms/",
 data: JSON.stringify(data),
 contentType: "application/json",
 dataType: "json",
 success: function (data, status) {
        call_back(data,status);
    },
    error: function (XMLHttpRequest, textStatus, errorThrown) {

                return false;
              }
});
}
function get_room_data(call_back){
         $.ajax({
             type: "GET",
             url: "/roomsbeds/",
             contentType: "application/json",
             dataType: "json",
             success: function (data, status) {
                    call_back(data,status);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                // console.log( XMLHttpRequest.responseText);
                // console.log(XMLHttpRequest.status + ' ' + XMLHttpRequest.statusText);
                return false;
              }
        });
}


function get_roomno_data(roomno,call_back){
         $.ajax({
             type: "GET",
             url: "/roomsbeds/"+roomno+"/",
             contentType: "application/json",
             dataType: "json",
             success: function (data, status) {
                    call_back(data,status);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                // console.log( XMLHttpRequest.responseText);
                // console.log(XMLHttpRequest.status + ' ' + XMLHttpRequest.statusText);
                return false;
              }
        });
}


</script>
</body>

</html>